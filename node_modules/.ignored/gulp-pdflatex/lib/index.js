"use strict";
const path_1 = require("path");
const through = require("through2");
const getRawBody = require("raw-body");
const node_pdflatex_1 = require("node-pdflatex");
const replaceExtension = (path, ext) => typeof path === 'string' ?
    path_1.join(path_1.dirname(path), path_1.basename(path, path_1.extname(path)) + ext) : path;
const gulpPdflatex = (options) => through.obj((file, encoding, next) => {
    if (file.isStream()) {
        file.extname = '.pdf';
        file.path = replaceExtension(file.path, file.extname);
        const output = node_pdflatex_1.default(file.contents, {
            shellEscape: options.shellEscape,
            texInputs: [file.base, ...options.texInputs],
        });
        file.contents = output;
        next(null, file);
    }
    else if (file.isBuffer()) {
        file.extname = '.pdf';
        file.path = replaceExtension(file.path, file.extname);
        const input = through();
        input.end(file.contents);
        const output = node_pdflatex_1.default(input, {
            shellEscape: options.shellEscape,
            texInputs: [file.base, ...options.texInputs],
        });
        getRawBody(output)
            .then(data => (file.contents = data) && next(null, file))
            .catch(err => next(err));
    }
    else
        next(null, file);
});
module.exports = gulpPdflatex;
//# sourceMappingURL=index.js.map